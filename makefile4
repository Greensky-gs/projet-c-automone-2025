CC=gcc
FLAGS=-Wall
output=gerer_sf_v4
deps=bloc.o inode.o sf.o repertoire.o
RM=rm -f
VERSION=V4
HREF=fourni/V4/bloc.h fourni/V4/inode.h fourni/V4/sf.h fourni/V4/repertoire.h
SANITIZES=-fsanitize=address,undefined -g

# Variable des sanitizers pass√©s dans la commande
SANITIZERS=
ifeq ($(strip $(S)),)
	ifneq (,$(findstring S,$(MAKEFLAGS)))
		# Si on a -S dans la ligne de commande on rajoute les sanitizers
		SANITIZERS=$(SANITIZES)
	endif
endif

# Message d'avertissement des sanitizers
ECHO_MSG=@echo -e "\033[0;32mCompilation normale\033[0m"

ifneq ($(strip $(SANITIZERS)),) # Modification
	ECHO_MSG=@echo -e "\033[0;31mAjout des sanitizers\033[0m"
endif

$(output): $(output).o $(deps)
	$(ECHO_MSG)
	$(CC) $(FLAGS) $(SANITIZERS) $(output).o $(deps) -o $(output).exe

$(output).o: $(output).c $(HREF)
	$(CC) $(FLAGS) $(SANITIZERS) -c $(output).c

bloc.o: fourni/$(VERSION)/bloc.c fourni/$(VERSION)/bloc.h
	$(CC) $(FLAGS) $(SANITIZERS) -c fourni/$(VERSION)/bloc.c
inode.o: fourni/$(VERSION)/inode.c fourni/$(VERSION)/inode.h
	$(CC) $(FLAGS) $(SANITIZERS) -c fourni/$(VERSION)/inode.c
sf.o: fourni/$(VERSION)/sf.c fourni/$(VERSION)/sf.h
	$(CC) $(FLAGS) $(SANITIZERS) -c fourni/$(VERSION)/sf.c
repertoire.o: fourni/$(VERSION)/repertoire.c fourni/$(VERSION)/repertoire.h
	$(CC) $(FLAGS) $(SANITIZERS) -c fourni/$(VERSION)/repertoire.c

clean:
	$(RM) *.o *.exe
